FROM centos:7

RUN yum install -y epel-release
RUN yum -y install make automake gcc gcc-c++ kernel-devel
RUN yum -y install python34
RUN yum -y install python-pip
RUN pip install --upgrade pip
RUN yum -y install postgresql-libs
RUN yum -y install postgresql-devel
RUN yum -y install python-devel
RUN pip install psycopg2

COPY blockchain blockchain/
COPY pki pki/
COPY requirements.txt .
COPY web_query_entrypoint.sh .
COPY setup.py .

RUN pip install -r requirements.txt
RUN chmod a+x blockchain/query_svc.py
RUN chmod a+x web_query_entrypoint.sh
RUN yum install openssh -y

ENTRYPOINT ["/bin/bash", "python /blockchain/query_svc.py --private-key /pki/sk.pem --public-key ./pki/pk.pem"]
CMD ["/bin/bash", "web_query_entrypoint.sh"]
