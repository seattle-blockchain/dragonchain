FROM centos:7
ARG BLOCKCHAIN_DB_HOSTNAME

RUN yum install -y openssl
RUN yum install -y epel-release
RUN yum -y install make automake gcc gcc-c++ kernel-devel
RUN yum -y install python34
RUN yum -y install python-pip
RUN pip install --upgrade pip
RUN yum -y install postgresql-libs
RUN yum -y install postgresql-devel
RUN yum -y install python-devel
RUN pip install psycopg2
RUN echo $PATH

COPY blockchain blockchain/
COPY pki pki/
# RUN mkdir pki
# RUN openssl ecparam -name secp384r1 -genkey -out /pki/sk.pem
# RUN openssl ec -in /pki/sk.pem -pubout -out /pki/pk.pem
COPY requirements.txt .
COPY setup.py .

RUN pip install -r requirements.txt
RUN chmod a+x blockchain/query_svc.py
#TODO Generate Keys
#CMD ["/bin/bash", "ssh-keygen -b 4096 -t rsa -f /tmp/sshkey -q -N """]
#CMD ["/bin/bash", "cat /tmp/sshkey > server.log 2>&1"]
ENTRYPOINT ["python", "blockchain/transaction_svc.py", "--private-key", "pki/sk.pem", "--public-key", "pki/pk.pem"]
